<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script src="https://use.typekit.net/xbr6agj.js"></script><script>try{Typekit.load({ async: true });}catch(e){}</script><script>window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = '6WVGW';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};
g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
g.clearUserCookie=function(c,d,i){if(!c || document.cookie.match('fs_uid=[`;`]*`[`;`]*`[`;`]*`')){
d=n.domain;while(1){n.cookie='fs_uid=;domain='+d+
';path=/;expires='+new Date(0).toUTCString();i=d.indexOf('.');if(i<0)break;d=d.slice(i+1)}}};
})(window,document,window['_fs_namespace'],'script','user');
</script><title> Parsing XML in iOS Using NSXMLParser Â· Raj Abishek</title><meta name="description" content="Parsing XML in iOS Using NSXMLParser - Raj Abishek"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/logo.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="https://dribbble.com/rajabishek" target="_blank" class="nav-list-link">Dribbble</a></li><li class="nav-list-item"><a href="https://in.linkedin.com/in/rajabishek" target="_blank" class="nav-list-link">LinkedIn</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">Rss</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Parsing XML in iOS Using NSXMLParser</h1><div class="post-info">May 1, 2016</div><div class="post-content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>We are going to populate a table view controller using a simple XML file from the web. The code examples in this article will be written using Swift. I assume that you have already setup the TableViewController to read the input and populate the table. We will be concentrating on parsing the XML file in this article.</p>
<a id="more"></a>
<p>To parse an XML file in iOS we can make use of the NSXMLParser class from the foundation framework. We will be working with an XML data that represents food menu so lets say that our table view controller class is called FoodTableViewController.</p>
<h2 id="Downloading-the-XML-data"><a href="#Downloading-the-XML-data" class="headerlink" title="Downloading the XML data"></a>Downloading the XML data</h2><p>The first thing that we have to do is download the XML data from the web. The NSURLSession class and related classes provide an API for downloading content.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">getData</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">let</span> defaultSession = <span class="type">NSURLSession</span>(configuration: <span class="type">NSURLSessionConfiguration</span>.defaultSessionConfiguration())</div><div class="line"></div><div class="line">    <span class="comment">//tells iOS to start the loading button on the status bar</span></div><div class="line">    <span class="type">UIApplication</span>.sharedApplication().networkActivityIndicatorVisible = <span class="literal">true</span></div><div class="line"></div><div class="line">    <span class="keyword">let</span> link = <span class="string">"http://www.w3schools.com/xml/simple.xml"</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> url = <span class="type">NSURL</span>(string: link) &#123;</div><div class="line">        <span class="keyword">let</span> dataTask = defaultSession.dataTaskWithURL(url) &#123;</div><div class="line">            data, response, error <span class="keyword">in</span></div><div class="line"></div><div class="line">            <span class="comment">//Stop the loading button in status bar - make sure this UI change is made in the main thread</span></div><div class="line">            dispatch_async(dispatch_get_main_queue()) &#123;</div><div class="line">                <span class="type">UIApplication</span>.sharedApplication().networkActivityIndicatorVisible = <span class="literal">false</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</div><div class="line">                <span class="built_in">print</span>(error.localizedDescription)</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> httpResponse = response <span class="keyword">as</span>? <span class="type">NSHTTPURLResponse</span> &#123;</div><div class="line">                <span class="keyword">if</span> httpResponse.statusCode == <span class="number">200</span> &#123;</div><div class="line">                    <span class="comment">//Create an XML parser with the NSData from the server and set the FoodTableViewController as the delegate</span></div><div class="line">                    <span class="keyword">let</span> xmlParser = <span class="type">NSXMLParser</span>(data: data!)</div><div class="line">                    xmlParser.delegate = <span class="keyword">self</span></div><div class="line">                    xmlParser.parse()</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        dataTask.resume()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The above code makes a http GET request to the link present in the link variable. Since the link represents a static XML file that is hosted on the server the response of the request will be the XML data. The link could also be an API that returns the data in XML format.</p>
<p>Once the XML data is downloaded it is made available in data variable ( which is of type NSData? ) of the completion handler. The entire process of making and sending the request and waiting for the response is performed in the background thread by the networking API so that the UI remains responsive. The callback handler that we provide to the dataTaskWithUrl method of the defaultSession object is also called from the background thread only after the data becomes available, therefore we must remember that any code that we write inside of the completion handler does not run in the main thread. </p>
<p>To understand more about the above code, I would suggest you to read the following. They will give you a lot more insight on how we can use the NSURLSession class, which is a complete suite of networking API methods for uploading and downloading content via HTTP.</p>
<blockquote>
<p><a href="https://www.objc.io/issues/5-ios7/from-nsurlconnection-to-nsurlsession/" target="_blank" rel="external">https://www.objc.io/issues/5-ios7/from-nsurlconnection-to-nsurlsession/</a><br><a href="https://www.raywenderlich.com/110458/nsurlsession-tutorial-getting-started" target="_blank" rel="external">https://www.raywenderlich.com/110458/nsurlsession-tutorial-getting-started</a><br><a href="https://developer.apple.com/library/ios/documentation/Foundation/Reference/NSURLSession_class/" target="_blank" rel="external">https://developer.apple.com/library/ios/documentation/Foundation/Reference/NSURLSession_class/</a></p>
</blockquote>
<p>This refreshData method is called from the viewDidLoad method on the table view controller to make sure the we start the process as soon as the view is loaded into the memory.<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">super</span>.viewDidLoad()</div><div class="line">    getData()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Parsing-the-XML"><a href="#Parsing-the-XML" class="headerlink" title="Parsing the XML"></a>Parsing the XML</h2><p>Like how every other functionality is built in iOS the XML parsing is also done through the delegation pattern. We create an instance of NSXMLParser class to help with the parsing. The parser will call certain methods on its delegate as it parses the XML document. Lets assign the FoodTableViewController class as the delegate for the parser. The NSXMLParserDelegate protocol defines the optional methods implemented by delegates of NSXMLParser objects.</p>
<p>We will be using 4 delegate methods to parse the file. The 4 delegate methods we will be focusing are:</p>
<blockquote>
<p>parser:didStartElement:namespaceURI:qualifiedName:attributes:<br>parser:foundCharacters:<br>parser:didEndElement:namespaceURI:qualifiedName:<br>parserDidEndDocument:</p>
</blockquote>
<h3 id="didStartElement-method"><a href="#didStartElement-method" class="headerlink" title="didStartElement method"></a>didStartElement method</h3><p>This method is called by the parser object on its delegate whenever it encounters an opening XML tag.</p>
<p>###foundCharacters method<br>This method is called by the parser object on its delegate whenever it is reading data between an opening tag and closing tag. The data between a tag may be read all at once or it may be read in pieces.</p>
<h3 id="didEndElement-method"><a href="#didEndElement-method" class="headerlink" title="didEndElement method"></a>didEndElement method</h3><p>This method is called by the parser object on its delegate whenever it encounters a closing XML tag.</p>
<h3 id="didEndDocument-method"><a href="#didEndDocument-method" class="headerlink" title="didEndDocument method"></a>didEndDocument method</h3><p>This method is called by the parser object on its delegate when it has completed parsing the entire document.</p>
<p>Consider the following XML data.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">to</span>&gt;</span>Tove<span class="tag">&lt;/<span class="name">to</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">from</span>&gt;</span>Jani<span class="tag">&lt;/<span class="name">from</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>Donât forget me this weekend!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">FoodTableViewController</span>: <span class="title">NSXMLParserDelegate</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String : String])</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Did start element: <span class="subst">\(elementName)</span>"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, foundCharacters string: String)</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Found characters: <span class="subst">\(string)</span>"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?)</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Did end element: <span class="subst">\(elementName)</span>"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parserDidEndDocument</span><span class="params">(parser: NSXMLParser)</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Completed parsing document"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If we implement the delegate methods as shown above then the output that we get is.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">Did start element: note</div><div class="line">Found characters:</div><div class="line"></div><div class="line">Did start element: to</div><div class="line">Found characters: Tove</div><div class="line">Did end element: to</div><div class="line">Found characters:</div><div class="line"></div><div class="line">Did start element: from</div><div class="line">Found characters: Jani</div><div class="line">Did end element: from</div><div class="line">Found characters:</div><div class="line"></div><div class="line">Did start element: heading</div><div class="line">Found characters: Reminder</div><div class="line">Did end element: heading</div><div class="line">Found characters:</div><div class="line"></div><div class="line">Did start element: body</div><div class="line">Found characters: Donât forget me this weekend!</div><div class="line">Did end element: body</div><div class="line">Found characters:</div><div class="line"></div><div class="line">Did end element: note</div><div class="line">Completed parsing document</div></pre></td></tr></table></figure>
<p>We will be using the following XML file for our demo.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">breakfast_menu</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>This is a simple name data<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">food</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Belgian Waffles<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>$5.95<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">desc</span>&gt;</span>Two of our famous Belgian Waffles with plenty of real maple syrup<span class="tag">&lt;/<span class="name">desc</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">calories</span>&gt;</span>650<span class="tag">&lt;/<span class="name">calories</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">food</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">food</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Strawberry Belgian Waffles<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>$7.95<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">desc</span>&gt;</span>Light Belgian waffles covered with strawberries and whipped cream<span class="tag">&lt;/<span class="name">desc</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">calories</span>&gt;</span>900<span class="tag">&lt;/<span class="name">calories</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">food</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">food</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Berry-Berry Belgian Waffles<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>$8.95<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">desc</span>&gt;</span>Light Belgian waffles covered with an assortment of fresh berries and whipped cream<span class="tag">&lt;/<span class="name">desc</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">calories</span>&gt;</span>900<span class="tag">&lt;/<span class="name">calories</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">food</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">food</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>French Toast<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>$4.50<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">desc</span>&gt;</span>Thick slices made from our homemade sourdough bread<span class="tag">&lt;/<span class="name">desc</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">calories</span>&gt;</span>600<span class="tag">&lt;/<span class="name">calories</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">food</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">food</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Homestyle Breakfast<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>$6.95<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">desc</span>&gt;</span>Two eggs, bacon or sausage, toast, and our ever-popular hash browns<span class="tag">&lt;/<span class="name">desc</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">calories</span>&gt;</span>950<span class="tag">&lt;/<span class="name">calories</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">food</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">breakfast_menu</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Lets define a few variable in Swift that can help us with the parsing. We create a food structure that represents a single food item. In swift if we donât provide an initializer for a structure it automatically provides a member wise initializer that we can use to create an instance.<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Food</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> name: <span class="type">String</span></div><div class="line">    <span class="keyword">let</span> price: <span class="type">String</span></div><div class="line">    <span class="keyword">let</span> desc: <span class="type">String</span></div><div class="line">    <span class="keyword">let</span> calories: <span class="type">String</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FoodTableViewController</span>: <span class="title">UITableViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> list = [<span class="type">Food</span>]()</div><div class="line"></div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">""</span></div><div class="line">    <span class="keyword">var</span> price: <span class="type">String</span> = <span class="string">""</span></div><div class="line">    <span class="keyword">var</span> desc: <span class="type">String</span> = <span class="string">""</span></div><div class="line">    <span class="keyword">var</span> calories: <span class="type">String</span> = <span class="string">""</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> currentlyParsingElement: <span class="type">String</span> = <span class="string">""</span></div><div class="line">    <span class="keyword">var</span> insideFoodItem = <span class="literal">false</span></div><div class="line">    <span class="comment">//Rest of your table view controller code here</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>We are interested only in the data within each of the food item. If we have lets say the <name> tag anywhere else in the XML we would not like to take that into account. Therefore when we encounter <food> i.e when we enter into a food tag we mark the insideFoodItem variable as true and set to false once we encounter </food>. This helps us identity at any point whether we are currently inside of a food item or not during the parsing process.</name></p>
<p>The currentlyParsingElement variable holds the name of the tag that we are currently parsing, i.e if we encounter a opening <name> tag then we set <code>currentlyParsingElement = &quot;name&quot;</code></name></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">FoodTableViewController</span>: <span class="title">NSXMLParserDelegate</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String : String])</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> elementName == <span class="string">"food"</span> &#123;</div><div class="line">            insideFoodItem = <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> insideFoodItem &#123;</div><div class="line">            <span class="keyword">switch</span> elementName &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">"name"</span>:</div><div class="line">                name = <span class="string">""</span></div><div class="line">                currentlyParsingElement = <span class="string">"name"</span></div><div class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</div><div class="line">                price = <span class="string">""</span></div><div class="line">                currentlyParsingElement = <span class="string">"price"</span></div><div class="line">            <span class="keyword">case</span> <span class="string">"desc"</span>:</div><div class="line">                desc = <span class="string">""</span></div><div class="line">                currentlyParsingElement = <span class="string">"desc"</span></div><div class="line">            <span class="keyword">case</span> <span class="string">"calories"</span>:</div><div class="line">                calories = <span class="string">""</span></div><div class="line">                currentlyParsingElement = <span class="string">"calories"</span></div><div class="line">            <span class="keyword">default</span>: <span class="keyword">break</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, foundCharacters string: String)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> insideFoodItem &#123;</div><div class="line">            <span class="keyword">switch</span> currentlyParsingElement &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">"name"</span>:</div><div class="line">                name = name + string</div><div class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</div><div class="line">                price = price + string</div><div class="line">            <span class="keyword">case</span> <span class="string">"desc"</span>:</div><div class="line">                desc = desc + string</div><div class="line">            <span class="keyword">case</span> <span class="string">"calories"</span>:</div><div class="line">                calories = calories + string</div><div class="line">            <span class="keyword">default</span>: <span class="keyword">break</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> insideFoodItem &#123;</div><div class="line">            <span class="keyword">switch</span> elementName &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">"name"</span>:</div><div class="line">                currentlyParsingElement = <span class="string">""</span></div><div class="line">            <span class="keyword">case</span> <span class="string">"price"</span>:</div><div class="line">                currentlyParsingElement = <span class="string">""</span></div><div class="line">            <span class="keyword">case</span> <span class="string">"desc"</span>:</div><div class="line">                currentlyParsingElement = <span class="string">""</span></div><div class="line">            <span class="keyword">case</span> <span class="string">"calories"</span>:</div><div class="line">                currentlyParsingElement = <span class="string">""</span></div><div class="line">            <span class="keyword">default</span>: <span class="keyword">break</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> elementName == <span class="string">"food"</span> &#123;</div><div class="line">                <span class="keyword">let</span> food = <span class="type">Food</span>(name: name, price: price, desc: desc, calories: calories)</div><div class="line">                list.append(food)</div><div class="line">                insideFoodItem = <span class="literal">false</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parserDidEndDocument</span><span class="params">(parser: NSXMLParser)</span></span> &#123;</div><div class="line">        dispatch_async(dispatch_get_main_queue()) &#123;</div><div class="line">            <span class="keyword">self</span>.tableView.reloadData()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>As you can see in the code above in the didStartElement method we clear out any existing data from the corresponding temporary variable and mark the element that is being currently parsed. We have the currentlyParsingElement variable because without it the foundCharacters method does not know for which tag the data that we are currently parsing belongs to. And in the foundCharacters method all that we do is append the data that we are parsing to the corresponding temporary variable ( we are appending because the data may not be parsed in a single go, it may be parsed in chunks ). In the dodEndElement method we clear out the currenlyParsingElement. If we donât clear out the currentlyParsingElement then the data inside the non interested tags will also get appended. Lets say we donât clear out the currenlyParsingElement variable which is set to ânameâ, then lets say now if we encounter a disinterested tad <date> then its content will also be appended to the name temporary variable, which is clearly what we donât want.</date></p>
<p>Once the XML document has been finished parsing, the parser object calls the parserDidEndDocument and we ask the table view to reload the data. You should remember that we called the parse method on the parser to start the parsing from the callback once the XML data has been downloaded. That callback is executed in the background thread when the XML downloading process is complete. Therefore all the parsing ( the method calls by parser on the delegate ) also happens in the background thread, i.e why we make sure that reloading the table data happens in the main thread, because any UI updates or changes that we make should always happen on the main thread.</p>
<p>Once the list is populated with data. It would look like the following.<br><img src="/img/xml-screenshot1.png" alt="Screenshot 1"></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/SOLID-Principles/" class="prev">PREV</a></div><div class="copyright"><p>Â© 2015 - 2017 <a href="http://rajabishek.com">Raj Abishek</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-93252193-1",'auto');ga('send','pageview');</script></body></html>