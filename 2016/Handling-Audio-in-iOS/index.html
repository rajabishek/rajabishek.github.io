<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script src="https://use.typekit.net/xbr6agj.js"></script><script>try{Typekit.load({ async: true });}catch(e){}</script><script>window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = '6WVGW';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};
g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
g.clearUserCookie=function(c,d,i){if(!c || document.cookie.match('fs_uid=[`;`]*`[`;`]*`[`;`]*`')){
d=n.domain;while(1){n.cookie='fs_uid=;domain='+d+
';path=/;expires='+new Date(0).toUTCString();i=d.indexOf('.');if(i<0)break;d=d.slice(i+1)}}};
})(window,document,window['_fs_namespace'],'script','user');
</script><title> Handling Audio in iOS · Raj Abishek</title><meta name="description" content="Handling Audio in iOS - Raj Abishek"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/logo.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="https://dribbble.com/rajabishek" target="_blank" class="nav-list-link">Dribbble</a></li><li class="nav-list-item"><a href="https://in.linkedin.com/in/rajabishek" target="_blank" class="nav-list-link">LinkedIn</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">Rss</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Handling Audio in iOS</h1><div class="post-info">Jun 3, 2016</div><div class="post-content"><h2 id="Leveraging-AVFoundation-Audio-APIs"><a href="#Leveraging-AVFoundation-Audio-APIs" class="headerlink" title="Leveraging AVFoundation Audio APIs"></a>Leveraging AVFoundation Audio APIs</h2><p>Its not a rare occurrence when you will have to deal with Audio data in your iOS apps. Lets take a look at how we can use the AVFoundation framework to play, restart, stop, pause audio file in our iOS apps. We will even have a look at how we can manipulate with the audio timings, ie go back/front to a specific time and play the audio from there.</p>
<a id="more"></a>
<h2 id="Follow-step-by-step-one-at-a-time"><a href="#Follow-step-by-step-one-at-a-time" class="headerlink" title="Follow step by step, one at a time"></a>Follow step by step, one at a time</h2><ul>
<li>Drag and drop 4 buttons on the storyboard scene from the object library and style and position the segment control the way you want, the 4 buttons are start, restart, play(pause), stop. Also drag and drop a slider onto the screen. The first button is use to load the music and start playing it. Its used for nothing else. The other 3 buttons will be the most used ones. The restart button will take the music to start and play it from first, the play(pause) is a single toggle button that is use for playing and pausing, the stop button will take the music to start and stop playing it.</li>
<li>Now lets add the outlet and the actions, add an outlet for the play(pause) button because we will be changing the button title as we play and pause the music file. Add 3 actions for the restart, stop and the start button. Add an outlet and an action(changeAudioTime) for the slider.</li>
<li><p>Get the path of the music file by using the following code.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> path = <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"musicname"</span>, ofType: <span class="string">"mp3"</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>Once you have the path of the resource create an instance of NSURL from the path</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> audioUrl = <span class="type">NSURL</span>(fileURLWithPath: path)</div></pre></td></tr></table></figure>
</li>
<li><p>Next we need to import the AVFoundation framework in the view controller file, this allows us to use the speakers on the iphone to play the music file that we have. There are 2 steps to be done here 1st is to place the code <code>import AVFoundation</code> in top of view controller file and the other step is to click on the project settings in the file explorer, the go to build phases, and make sure you are selected on target, the click the + button in link binary with libraries, type AVFoundation in the dialog and click add.</p>
</li>
<li>Next step is to create a audio player and give it the contents of the music file that we have with us.</li>
<li>To start playing the music we can call the play method on the audio player, to pause playing the music we can call the stop method on the audio player, to change the timings of the music we can use the currentTime property of the audio player.</li>
<li>In the code below we start playing the music once the view is loaded into the memory, we can’t present the alert controller here because it can be presented only when the view controller hierarchy is set up, that is why we present the alert controller in the viewDidAppear method which is called after the view hierarchy is setup, ie after the views appear on the screen.</li>
<li>Always remember that you must stop playing the audio before manipulating with the currentTime of the audio player.</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"><span class="keyword">import</span> AVFoundation</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> pauseOrPlayButton: <span class="type">UIButton</span>!</div><div class="line">    </div><div class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> audioTimer: <span class="type">UISlider</span>!</div><div class="line">    </div><div class="line">    <span class="keyword">let</span> audioPlayer: <span class="type">AVAudioPlayer</span>? = &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> audioPath = <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"audio"</span>, ofType: <span class="string">"wav"</span>) &#123;</div><div class="line">            <span class="keyword">let</span> audioUrl = <span class="type">NSURL</span>(fileURLWithPath: audioPath)</div><div class="line">            </div><div class="line">            <span class="keyword">do</span> &#123;</div><div class="line">                <span class="keyword">let</span> player = <span class="keyword">try</span> <span class="type">AVAudioPlayer</span>(contentsOfURL: audioUrl)</div><div class="line">                <span class="keyword">return</span> player</div><div class="line">            &#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">NSError</span> &#123;</div><div class="line">                <span class="built_in">print</span>(error.localizedDescription)</div><div class="line">                <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"Music file not found."</span>)</div><div class="line">            <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;()</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">preferredStatusBarStyle</span><span class="params">()</span></span> -&gt; <span class="type">UIStatusBarStyle</span> &#123;</div><div class="line">        <span class="keyword">return</span> .<span class="type">LightContent</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        <span class="comment">//Set a custom image for the slider circle for both the states</span></div><div class="line">        audioTimer.setThumbImage(<span class="type">UIImage</span>(named: <span class="string">"slider-thumbnail"</span>), forState: .<span class="type">Normal</span>)</div><div class="line">        audioTimer.setThumbImage(<span class="type">UIImage</span>(named: <span class="string">"slider-thumbnail"</span>), forState: .<span class="type">Highlighted</span>)</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> player = audioPlayer &#123;</div><div class="line">            player.play()</div><div class="line">            <span class="comment">//duration property is of type NSTimeInterval aka Double, therefore convert it to float</span></div><div class="line">            audioTimer.maximumValue = <span class="type">Float</span>(player.duration)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//Every 0.1 seconds iOS will call the updateAudioTimer method to keep the slider in sync</span></div><div class="line">        <span class="type">NSTimer</span>.scheduledTimerWithTimeInterval(<span class="number">0.1</span>, target: <span class="keyword">self</span>, selector: #selector(<span class="type">ViewController</span>.updateAudioTimer), userInfo: <span class="literal">nil</span>, repeats: <span class="literal">true</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidAppear</span><span class="params">(animated: Bool)</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidAppear(animated)</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> audioPlayer == <span class="literal">nil</span> &#123;</div><div class="line">            <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">"Opps"</span>, message: <span class="string">"Audio Error"</span>, preferredStyle: .<span class="type">Alert</span>)</div><div class="line">            alert.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">"Ok"</span>, style: .<span class="type">Default</span>, handler: <span class="literal">nil</span>))</div><div class="line">            presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">restartAudio</span><span class="params">(sender: AnyObject)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> player = audioPlayer &#123;</div><div class="line">            player.stop()</div><div class="line">            player.currentTime = <span class="number">0</span></div><div class="line">            player.play()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">pauseOrPlayAudio</span><span class="params">(sender: AnyObject)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> player = audioPlayer &#123;</div><div class="line">            <span class="keyword">if</span> player.playing &#123;</div><div class="line">                <span class="comment">//User pressed the pause button</span></div><div class="line">                player.stop()</div><div class="line">                pauseOrPlayButton.setTitle(<span class="string">"Play"</span>, forState: .<span class="type">Normal</span>)</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                player.play()</div><div class="line">                pauseOrPlayButton.setTitle(<span class="string">"Pause"</span>, forState: .<span class="type">Normal</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">stopAudio</span><span class="params">(sender: AnyObject)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> player = audioPlayer &#123;</div><div class="line">            player.stop()</div><div class="line">            player.currentTime = <span class="number">0</span></div><div class="line">            pauseOrPlayButton.setTitle(<span class="string">"Play"</span>, forState: .<span class="type">Normal</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">changeAudioTime</span><span class="params">(sender: AnyObject)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> player = audioPlayer &#123;</div><div class="line">            player.stop()</div><div class="line">            player.currentTime = <span class="type">NSTimeInterval</span>(audioTimer.value)</div><div class="line">            <span class="comment">//player.prepareToPlay()</span></div><div class="line">            player.play()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateAudioTimer</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> player = audioPlayer &#123;</div><div class="line">            <span class="comment">//currentTime property is of type NSTimeInterval aka Double, therefore convert it to float</span></div><div class="line">            audioTimer.value = <span class="type">Float</span>(player.currentTime)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div></article></div></section><footer><div class="paginator"><a href="/2016/Network-requests-with-NSURLSession/" class="prev">PREV</a><a href="/2016/Arrays-in-Swift/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://rajabishek.com">Raj Abishek</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-93252193-1",'auto');ga('send','pageview');</script></body></html>