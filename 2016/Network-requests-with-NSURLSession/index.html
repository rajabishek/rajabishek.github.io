<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script src="https://use.typekit.net/xbr6agj.js"></script><script>try{Typekit.load({ async: true });}catch(e){}</script><script>window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = '6WVGW';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};
g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
g.clearUserCookie=function(c,d,i){if(!c || document.cookie.match('fs_uid=[`;`]*`[`;`]*`[`;`]*`')){
d=n.domain;while(1){n.cookie='fs_uid=;domain='+d+
';path=/;expires='+new Date(0).toUTCString();i=d.indexOf('.');if(i<0)break;d=d.slice(i+1)}}};
})(window,document,window['_fs_namespace'],'script','user');
</script><title> Network Requests With NSURLSession · Raj Abishek</title><meta name="description" content="Network Requests With NSURLSession - Raj Abishek"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/logo.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="https://dribbble.com/rajabishek" target="_blank" class="nav-list-link">Dribbble</a></li><li class="nav-list-item"><a href="https://in.linkedin.com/in/rajabishek" target="_blank" class="nav-list-link">LinkedIn</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">Rss</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Network Requests With NSURLSession</h1><div class="post-info">Jul 20, 2016</div><div class="post-content"><h2 id="HTTP-Requests"><a href="#HTTP-Requests" class="headerlink" title="HTTP Requests"></a>HTTP Requests</h2><p>We are living in world today where information is being rapidly exchanged between every device that we use. Almost every application on the market these days consume content through a web service. While Alamofire is a rich networking library that can be used to access APIs, you can also use NSURLSessions’s asynchronous data task requests for quick and dirty REST calls. Infact Alamofire library is nothing but a wrapper around <code>NSURLSession</code> written in Swift that simplifies making HTTP requests.</p>
<a id="more"></a>
<h2 id="So-where-do-we-start"><a href="#So-where-do-we-start" class="headerlink" title="So where do we start ?"></a>So where do we start ?</h2><ul>
<li>Apple has introduced App Transport Security(ATS) in iOS 9. ATS requires SSL to be used for transferring data and it is pretty picky about how it’s implemented. Sadly this means that a lot of servers out there don’t meet the ATS requirements. So what can we do if we need to work with one of these servers? We’ll have to add an exception to App Transport Security for that server.</li>
<li>While we could just disable ATS itself, but it’s much more secure to create an exception only for the one server that we need to access which is not ATS compliant. The API that we’ll be using in this chapter is at <a href="http://jsonplaceholder.typicode.com/" target="_blank" rel="external">http://jsonplaceholder.typicode.com/</a> so that’s what we’ll create the exception for.</li>
<li>To create the exception we’ll need to add some keys to the info.plist in our project. We’ll add a new row and select App Transport Security Settings from the drop down. That will create a dictionary for us. Then we’ll click the + sign to add a row to the dictionary and choose Exception Domains. And add a row in that dictionary. Change the new row to a dictionary and change its name to jsonplaceholder.typicode.com (note: no trailing slashes and no http or https prefix). Within the jsonplaceholder.typicode.com dictionary, add a single boolean entry <code>NSThirdPartyExceptionAllowsInsecureHTTPLoads</code> set to YES</li>
<li>JSONPlaceholder is a fake online REST API for testing and prototyping. You can check it out at <a href="http://jsonplaceholder.typicode.com" target="_blank" rel="external">http://jsonplaceholder.typicode.com</a></li>
<li>First step would be to create a <code>NSURL</code> instance of the endpoint</li>
<li>Then we need to create a <code>NSURLRequest</code> object with the url object</li>
<li>Create a session object to create a task to send the request</li>
<li>Create a task to send the request from the session object</li>
<li>Start the task to actually send the http request</li>
<li>Now once we get the response the callback that we gave will be executed, make sure we got data and no error</li>
<li>Try to transform the data into JSON (since that’s the format returned by the API)</li>
<li>Access the todo object in the JSON and print out the title</li>
<li>The default request is a GET request, to make a different kind of HTTP request we create a NSMutableRequest and set the <code>HTTPMethod</code> &amp; <code>HTTPBody</code> appropriately<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeGetRequest</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> url = <span class="type">NSURL</span>(string: <span class="string">"http://jsonplaceholder.typicode.com/todos/1"</span>) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> request = <span class="type">NSURLRequest</span>(<span class="type">URL</span>: url)</div><div class="line">        <span class="keyword">let</span> session = <span class="type">NSURLSession</span>(configuration: <span class="type">NSURLSessionConfiguration</span>.defaultSessionConfiguration())</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> task = session.dataTaskWithRequest(request, completionHandler: &#123; data, response, error <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> responseError = error &#123;</div><div class="line">                <span class="built_in">print</span>(<span class="string">"Error calling GET on /todos/1"</span>)</div><div class="line">                <span class="built_in">print</span>(responseError)</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> responseData = data &#123;</div><div class="line">                <span class="keyword">do</span> &#123;</div><div class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> todo = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.<span class="type">JSONObjectWithData</span>(responseData, options: []) <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>] &#123;</div><div class="line">                        <span class="keyword">if</span> <span class="keyword">let</span> title = todo[<span class="string">"title"</span>] &#123;</div><div class="line">                            <span class="keyword">if</span> <span class="keyword">let</span> name = title <span class="keyword">as</span>? <span class="type">String</span> &#123;</div><div class="line">                                <span class="built_in">print</span>(name)</div><div class="line">                            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                <span class="built_in">print</span>(<span class="string">"The title could not be converted to a string"</span>)</div><div class="line">                            &#125;</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            <span class="built_in">print</span>(<span class="string">"There was not title in the dictionary"</span>)</div><div class="line">                        &#125;</div><div class="line">                        </div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="built_in">print</span>(<span class="string">"Unable to convert the data to JSON"</span>)</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">catch</span> &#123;</div><div class="line">                    <span class="built_in">print</span>(<span class="string">"Unable to convert the data to JSON"</span>)</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        task.resume()</div><div class="line">        </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"The url is not a valid one"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">makePostRequest</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> url = <span class="type">NSURL</span>(string: <span class="string">"http://jsonplaceholder.typicode.com/todos"</span>) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> request = <span class="type">NSMutableURLRequest</span>(<span class="type">URL</span>: url)</div><div class="line">        request.<span class="type">HTTPMethod</span> = <span class="string">"POST"</span></div><div class="line">        <span class="keyword">let</span> newTodo = [<span class="string">"title"</span>: <span class="string">"Frist todo"</span>, <span class="string">"completed"</span>: <span class="literal">false</span>, <span class="string">"userId"</span>: <span class="number">1</span>]</div><div class="line">        <span class="keyword">do</span> &#123;</div><div class="line">            <span class="keyword">let</span> jsonData = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.dataWithJSONObject(newTodo, options: [])</div><div class="line">            request.<span class="type">HTTPBody</span> = jsonData</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> session = <span class="type">NSURLSession</span>(configuration: <span class="type">NSURLSessionConfiguration</span>.defaultSessionConfiguration())</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> task = session.dataTaskWithRequest(request, completionHandler: &#123; data, response, error <span class="keyword">in</span></div><div class="line">                <span class="keyword">if</span> <span class="keyword">let</span> responseError = error &#123;</div><div class="line">                    <span class="built_in">print</span>(<span class="string">"Error calling GET on /todos/1"</span>)</div><div class="line">                    <span class="built_in">print</span>(responseError)</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                <span class="keyword">if</span> <span class="keyword">let</span> responseData = data &#123;</div><div class="line">                    <span class="keyword">do</span> &#123;</div><div class="line">                        <span class="keyword">if</span> <span class="keyword">let</span> todo = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.<span class="type">JSONObjectWithData</span>(responseData, options: []) <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>] &#123;</div><div class="line">                            <span class="keyword">if</span> <span class="keyword">let</span> id = todo[<span class="string">"id"</span>] &#123;</div><div class="line">                                <span class="keyword">if</span> <span class="keyword">let</span> identifier = id <span class="keyword">as</span>? <span class="type">Int</span> &#123;</div><div class="line">                                    <span class="built_in">print</span>(identifier)</div><div class="line">                                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                    <span class="built_in">print</span>(<span class="string">"The identifier could not be converted to a integer"</span>)</div><div class="line">                                &#125;</div><div class="line">                            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                <span class="built_in">print</span>(<span class="string">"There was not identifier in the dictionary"</span>)</div><div class="line">                            &#125;</div><div class="line">                            </div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            <span class="built_in">print</span>(<span class="string">"Unable to convert the data to JSON"</span>)</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">catch</span> &#123;</div><div class="line">                        <span class="built_in">print</span>(<span class="string">"Unable to convert the data to JSON"</span>)</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">            task.resume()</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"Cannot create data from JSON object"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"The url is not a valid one"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/2016/Sending-an-email-from-iOS/" class="prev">PREV</a><a href="/2016/Handling-Audio-in-iOS/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://rajabishek.com">Raj Abishek</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-93252193-1",'auto');ga('send','pageview');</script></body></html>